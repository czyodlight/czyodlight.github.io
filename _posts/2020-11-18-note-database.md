---
layout: post
title: 数据库学习笔记
date: 2020-11-18
Author: halin
tag: [note]
conmment: false
toc: true

---

数据库系统原理学习笔记
<!-- more -->
## 数据模型

- 关系模型：以表的形式组织数据
- 层次模型：树
- 网状模型：图

## 数据库系统结构

- 开发者角度：三级结构
  - 外模式
  - 模式
  - 内模式
- 用户角度：
  - 单用户结构
  - 主从式结构
  - 分布式结构
  - 客户-服务器
  - 浏览器-应用服务器/数据库服务器

## 关系数据库

- 笛卡尔积：所有域取值任意组合
- 关系：
  - R(D1, D2.... Dn)是笛卡尔积的子集叫做关系
  - 其中n为关系的目或度
- 元组：关系中的每个元素
- 码：唯一区分实体的属性集叫候选码，选定其中一个叫主码也叫主键
- 外码：K是关系A中主码，K是B中的一个或一组属性，K是B外码
  - A是被参照关系
  - B是参照关系 
- 完整性规则：必须存在某组元素
- 参照完整性规则：参照关系外码或者是空集或者是被参照关系中的主码值

## 关系代数

|      含义      | 运算符 |
| :------------: | :----: |
| 传统运算 ：并  |   U    |
|       交       |   ∩    |
|       差       |   -    |
|    笛卡尔积    |   ×    |
| 专门运算：选择 |   σ    |
|      投影      |   π    |
|       除       |   ÷    |
|      连接      |   ⋈    |

- 一些记号：$R，t∈R，t[A_i]$
  - R是一个关系
  - t是R中一个元组
  - $A_i$是t中的一个属性

- 串接 :$\overset{\frown}{t_rt_s}$

  - t是两个不同元组分别为m，n目
  - 串接后结果为n+m列元组

- 象集：$Z_x$

  - 表示R关系中包含x的元组，该元组集除去x后叫象集


- 传统运算：
  - 两个关系要相容，即形式一样
  - 运算单位为一个元组
- 专门关系运算
  - 选择σ：又称限制
    - 在关系中选择符合条件的元组
    - 选择条件是一个逻辑表达式
    - 写法：$σ_{F}(R)$ ,F为选择条件表达式，R为关系名
  - 投影π：
    - 在关系中选出若干个列组成新的关系
    - 选出后重复元组去掉
    - 写法：$π_{D}(R)$ D为所选一个或多个列名，R为关系名
  - 连接 ⋈（join）：也称Θ连接![连接操作符](/images/imageOfDatebase/连接操作符.png)


    - θ连接：$R⋈_{AθB}S=σ_{AθB} (R×S)$
    - 自然连接（缺省条件R.B=S.B，只保留一列B）： $R⋈S=π_{U-B} (σ_{R.BθS.B} (R×S) )$
    - 外连接：在自然连接中加入被舍弃的元组，左元组加入这右元组元素为NULL。左（右）连接是只加入被舍弃的左（右）元组。
    - 悬浮元组：自然连接中被舍弃的元组
- 除运算÷：R÷S，在R中找到包含了S所有元组的象集

## 数据库管理

- 创建数据库

  ![创建数据库](/images/imageOfDatebase/创建数据库.png)

  ![数据库创建file语句格式](/images/imageOfDatebase/数据库创建file语句格式.png)

  - 文件组属性：

    - 逻辑名称：数据文件和日志文件名称文件类型：数据文件及日志文件文件组：各个数据文件所属的文件组名称初始大小：文件大小
    - 自动增长：文件按指定的大小增长，也可限制到最大容量。
      路径：存放文件的物理目录
    - 文件名：显示数据文件和日志文件的物理名称

  - 一个数据库可以有多个数据文件和日志文件，日志文件扩展名为Idf，数据文件扩展名为mdf和ndf两种，mdf表示该文件是主数据文件（一个数据库中只有一个mdf）

     	

- 删除数据库：DROP DATABASE database_name



## 数据表管理

- 常见数据类型：

  ![sql大型数据类型](/images/imageOfDatebase/sql大型数据类型.png)

  ![sql精确数据类型](/images/imageOfDatebase/sql精确数据类型.png)

  ![sql精确数值类型2](/images/imageOfDatebase/sql精确数值类型2.png)

  ![sql近似数据类型](/images/imageOfDatebase/sql近似数据类型.png)

  ![sql二进制类型](/images/imageOfDatebase/sql二进制类型.png)

  ![sql货币数据类型](/images/imageOfDatebase/sql货币数据类型.png)

  ![sql日期和时间类型](/images/imageOfDatebase/sql日期和时间类型.png)

  ![sql文本数据类型](/images/imageOfDatebase/sql文本数据类型.png)

  ![sql字符类型](/images/imageOfDatebase/sql字符类型.png)



### 数据更新

- 插入数据（插入元组以及插入子查询）

  ![数据更新插入单个元组](/images/imageOfDatebase/数据更新插入单个元组.png)

  ![数据更新插入子查询](/images/imageOfDatebase/数据更新插入子查询.png)

- 修改数据：

  ![数据更新修改](/images/imageOfDatebase/数据更新修改.png)

- 删除数据：

  ![数据更新删除数据](/images/imageOfDatebase/数据更新删除数据.png)

### 集合查询

- 对两个或多个查询结果进行查询

- UNION 并

- INTERSECT 交

- EXCEPT 差

- ORDER BY只能在最后，可用数字指定某一列排序

  

## 数据库安全性控制

- 用户身份鉴别

  - 静态口令
  - 动态口令
  - 智能卡（不可复制硬件）
  - 生物特征识别

- 存取控制（防止权值越界）

  - 定义用户权限
  - 合法权限检查

- 自主存取控制

  ![自主存取控制](/images/imageOfDatebase/自主存取控制.png)

  - 用户对不同的数据对象有不同的存取权限

  - 不同的用户对同-对象也有不同的权限

  - 用户还可将其拥有的存取权限转授给其他用户

  - GRANT语句和REVOKE语句

    - ![权限授予](/images/imageOfDatebase/权限授予.png)

    - ![回收权限](/images/imageOfDatebase/回收权限.png)

    - 授予查询某行权限：

      GRANT SELECT(Sno, Sname)
      ON TABLE  Student TO U2;

    - 授予所有权限 GRANT ALL PRIVILIGES

      

## 视图机制

![建立视图格式](/images/imageOfDatebase/建立视图格式.png)

![视图删除](/images/imageOfDatebase/视图删除.png)

![视图需要明确定义列明情况](/images/imageOfDatebase/视图需要明确定义列明情况.png)

- WITH CHECK OPTION:对视图进行操作更新时需要满足子查询中条件表达式如WHERE
- CREATE VIEW只把定义存入数据字典，并不执行select, 对视图查询时按视图定义从基本表中查出

**审计**



## 关系数据库理论

问题引入：把学生信息表和选课表做成同一表，引发插入异常，更新异常，删除异常，数据冗余过大

- 函数依赖

  -  x->y ,x决定y,多对一，一对一
  -  函数依赖不是指关系模式R的某个或某些关系实例满足的约束条件，而是指R的所有关系实例均要满足的约束条件

  ![函数依赖例子](/images/imageOfDatebase/函数依赖例子.png)

  - 平凡依赖：x->y,y∈X
  - 非平凡依赖:x->y，y∉x
  - 完全依赖：x->y，x的真子集x'!->y
  - 部分依赖：x真子集能决定y
  - 传递依赖：x->y,y!->x,y->z z对x传递依赖

- 码

  - 关系R,k->U,k为超码。U对k完全依赖则称为候选码。
  - 主属性：候选码中的属性，称作主属性。
  - 非主属性：不包含在任何一个候选码中的属性，称作非主属性。

- 范式

  - 第一范式：不可分基本数据项表
  - 第二范式： 每一个非主属性都完全函数依赖于R的任何一个候选码
  - 第三范式：关系中非主属性不存在传递依赖于候选码，不存在有x->y,y!->x,y->z.码x,属性组y，非主属性z
  - BC范式：x->y当x不包含y时，x含有码；每一个决定属性集（因素）都包含（候选）码，R中的所有属性（主，非主属性）都完全函数依赖于不包含它的码

- 数据依赖的的公理系统

  - 数据依赖的公理系统是模式分解算法的理论基础。

  - 函数依赖的一个有效而完备的公理系统一Armstronq公 理系统，
    -套推理规则，是模式分解算法的理论基础。

  - 逻辑蕴含：

    对于满足一组函数依赖 F 的关系模式R <U，F>，其任何一个关系r，若函数依赖X→Y都成立, （即r中任意两元组t，s，若t[X］=s[X］，则t[Y］=s[Y］），则称F逻辑蕴含X →Y

  - Armstrong公理系统：关系模式R <U，F >来说有以下的推理规则：

    - 自反律（Reflexivity）：若Y⊆X⊆U，则X →Y为F所蕴含。
    - 增广律（Augmentation）：若X→Y为F所蕴含，且Z ⊆U，则XZ→YZ为F所蕴含。
    - 传递律（Transitivity）：若X→Y及Y→Z为F所蕴含，则X→Z为F所蕴含。
    - 根据上三条推理规则可以得到下面三条推理规则：
      - 合并规则：由X→Y，X→Z，有X→YZ。
      - 伪传递规则：由X→Y，WY→Z，有XW→Z。
      - 分解规则：由X→Y及 Z⊆Y，有X→Z。

  - 函数依赖闭包：

  - 在关系模式R<U，F>中为F所逻辑蕴含的函数依赖的全体叫作 F的闭包，记为F+。

  - 设F为属性集U上的一组函数依赖，X⊆U，$X^{F+}$ ={ A|X→A能由F 根据Armstrong公理导出}，$X^{F+}$称为属性集X关于函数依赖集F 的闭包

  - 设F为属性集U上的一组函数依赖，X，Y⊆U，X→Y能由F根据Armstrong公理导出的充分必要条件是Y⊆$X^{F+}$。

    用途    将判定X→Y是否能由F根据Armstrong公理导出的问题，转化为求出$X^{F+}$ 、判定Y是否为$X^{F+}$的子集的问题

- Armstrong公理系统的有效性与完备性

- 函数依赖集等价:

  - 如果G+=F+，就说函数依赖集F覆盖G（F是G的覆盖，或G是F的覆盖），或F与G等价。

- F+ = G+ 的充分必要条件是F  G+ ，和G  F+ 

  - 最小依赖集：

  - 如果函数依赖集F满足下列条件，则称F为一个极小函数依赖集。亦称为最小依赖集或最小覆盖。

    1. F中任一函数依赖的右部仅含有一个属性。
      2. F中不存在这样的函数依赖X→A，使得F与F-{X→A}等价。
    3. F中不存在这样的函数依赖X→A， X有真子集Z使得F-{X→A}∪{Z→A}与F等价。

    - 每一个函数依赖集F均等价于一个极小函数依赖集Fm。此Fm称为F的最小依赖集。

    

## 数据库设计

- 规范设计法：

  - 新奥尔良（New Orleans）方法
  - 基于E-R模型的设计方法（概念设计阶段广泛采用）
  - 3NF（第三范式）的设计方法（逻辑阶段可采用的有效方法）
  - 面向对象的数据库设计方法
  - 统一建模语言（UML）方法

- 数据库设计工具
  SYBASE PowerDesigner
  数据库建模-UML工具
   Rational Rose
  UML工具-数据库建模
  CA ERWin ERwin全称是ERwin Data Modele
  功能强大、易于使用的数据建模、数据库设计与开发工具

- 数据库设计步骤

  ![数据库设计步骤](/images/imageOfDatebase/数据库设计步骤.png)

- 概念结构设计

  - 概念模型：

    - 将需求分析得到的用户需求抽象为信息结构即概念模型的过程是概念结构设计；
    - 抽象：现实世界->信息世界->机器世界

  - E-R模型：对信息世界抽象模型

    - 用E-R图来表示现实世界中实体与实体之间的联系。

    - 实体（Entity）：客观存在并可相互区别的事物。可以是具体的人、事、物或抽象的概念。如一个学生

    - 实体集（Entity Set）：同--类型实体的集合称为实体集。如所有学生的集合就是一个实体集

    - 实体型（Entity Type）：用实体名及其属性名集合来抽象和刻画同类实体称为实体型。如：学生（学号，姓名，性别，出生年月，所在院系，入学时间）

    - 属性：

      - 实体所具有的某一 特性称为属性。一个实体可以由若干个属性来刻画。
      - 分类：
        - 简单/单一属性和复合属性：学号，地址（可细分）
        - 单值属性和多值属性：学号，电话号码（有多个）
        - 派生属性/导出属性:年龄（可由出生日期推出）
        - 可空值属性和非空值属性

    - 实体间联系（E-R关注的）：

      ![实体联系例子](/images/imageOfDatebase/实体联系例子.png)

      - 一对一，一对多，多对多

      - 联系的度/元:实体型数目
      - 联系的基数：不同实体集中实例之间联系的数量，一对多，一对一，多对多。
      - 基数约束
        - 基数约束通常(min……max)来标记
        - 强制参与约束：min=1
        - 非强制参与约束：min=0

    - E-R图画法

      - 实体型：用矩形表示
      - 属性：用椭圆形表示
        - 多值属性：用双线椭圆表示
        - 派生/导出属性；用虚线椭圆表示
      - 码/关键字：加下划线
      - 连接实体型和属性：直线
      - 联系：用菱形表示
      - 连接实体与联系：直线
      - 联系也可以有属性，连接联系和属性：直线
      - 联系类别(基数)：用1:m方式或箭头表示，箭头指向1方向
      - 弱实体型：主键的一部分或全部从其依赖的强实体型中获得，在E-R图中用双矩形表示弱实体型，用双菱形表示弱实体型与它依赖的强实体型之间的识别联系。

  - 划分实体与属性的两条准则：

    - 作为属性，不能再具有需要描述的性质。（家庭住址，电话号码多值属性，可以设计一个弱实体型）
      属性必须是不可分的数据项，不能包含其他属性。
    - 属性不能与其他实体具有联系。E-R图中所表示的联系是实体与实体之间的联系。

  - E-R图的集成

    - 子E-R图合并，修改重构
    - 子系统E-R图之间的冲突主要有三类：
      ①属性冲突
      ②命名冲突
      ③结构冲突
    - 消除不必要的冗余，设计基本E-R图
      - 冗余的数据是指：可由基本数据导出的数据
      - 冗余的联系是指：可由其他联系导出的联系
      - 冗余带来的问题：破坏数据库的完整性，数据库维护困难，应当予以消除
      - 用分析方法消除冗余
      - 用规范化理论来消除冗余

- 逻辑结构设计

  - 任务：把概念结构设计阶段设计好的基本E-R图转换为与选用的DBMS产
    品所支持的逻辑结构
  - 实体型间的1：1联系：
    - 可以转换为一个独立的关系模式
    - 也可以与相连的任意一端对应的关系模式合并（推荐使用）
  - 实体型间的1：n联系：
    - 可以转换为-个独立的关系模式
    - 与n端对应的关系模式合并
  - 实体型间的m:n联系：
    一个m:n联系合并转换为一个关系模式

- 数据模型的优化

  - 三个或三个以上实体间的一个多元联系：转换为一个关系模式,如：“供应"联系转换成一个独立的关系模式供应（产品号， 供应商号.零件号，供应量）
  - 具有相同码的关系模式可合并

## 嵌入式SQL

- 建立数据库连接

	![c建立数据库连接](/images/imageOfDatebase/c建立数据库连接.png)

  ![c建立数据库连接续](/images/imageOfDatebase/c建立数据库连接续.png)



- 定义主变量

  ![嵌入sql定义主变量](/images/imageOfDatebase/嵌入sql定义主变量.png)



- 执行SQL语句

  ![嵌入SQL执行语句](/images/imageOfDatebase/嵌入SQL执行语句.png)

  ![嵌入式SQL执行语句例子](/images/imageOfDatebase/嵌入式SQL执行语句例子.png)

  ![嵌入式SQL执行语句例子2](/images/imageOfDatebase/嵌入式SQL执行语句例子2.png)



- 关闭数据库：EXEC SQL DISCONNECT [connection];

- 通信机制

  1. 向主语言传递SQL语句的执行状态信息，使主语言能够据此控制程序流程，主要用SQL通信区(SQLCA)实现

     ![SQLCA](/images/imageOfDatebase/SQLCA.png)

  2. 主语言向SQL语句提供参数，主要用主变量实现，使用时主变量前面加“：”

     ![主变量](/images/imageOfDatebase/主变量.png)

  3. 将SQL语句查询数据库的结果返回给主语言处理，主要用主变量和游标实现

     ![游标](/images/imageOfDatebase/游标.png)

     ![打开游标](/images/imageOfDatebase/打开游标.png)

     ![推进游标](/images/imageOfDatebase/推进游标.png)

     关闭EXEC SQL CLOSE <游标名>；



## 过程化SQL

- 基本结构：
  1. 定义部分
     DECLARE变量、常量、游标、异常等
     ●定义的变量、常量等只能在该基本块中使用
     ●当基本块执行结束时，定义就不再存在
  2. 执行部分
     BEGIN SQL语句、过程化SQL的流程控制语句EXCEPTION异常处理部分
     END：

- 存储过程：由过程化SQL语句书写的一段程序，经编译和优化后，命名并存储在数据库服务器中，使用时只要调用即可。

## ODBC

odbc是数据库统一接口，将不同类型数据库抽象出来统一接口

![ODBC工作流程](/images/imageOfDatebase/ODBC工作流程.png)

![3种语言对应数据类型](/images/imageOfDatebase/3种语言对应数据类型.png)

初始化：![环境句柄定义](/images/imageOfDatebase/环境句柄定义.png)![连接句柄定义](/images/imageOfDatebase/连接句柄定义.png)![语句句柄定义](/images/imageOfDatebase/语句句柄定义.png)![ODBC执行sql语句](/images/imageOfDatebase/ODBC执行sql语句.png)

执行处理：![带参数执行语句API](/images/imageOfDatebase/带参数执行语句API.png)![SQLBindParameter参数说明](/images/imageOfDatebase/SQLBindParameter参数说明.png)

结果处理：![结果集处理API](/images/imageOfDatebase/结果集处理API.png)